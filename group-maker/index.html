<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒãƒ¼ãƒ„ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap');

        body {
            font-family: 'Kosugi Maru', sans-serif;
            background-color: #f0f9ff;
            background-image: radial-gradient(#60a5fa 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .sports-icon {
            animation: bounce 2s infinite alternate;
        }

        @keyframes bounce {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-10px);
            }
        }

        .btn-sports {
            transition: all 0.3s;
        }

        .btn-sports:hover {
            transform: scale(1.05);
        }

        .group-card {
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .group-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .member-item {
            cursor: grab;
            transition: all 0.2s;
        }

        .member-item:hover {
            background-color: #f3f4f6;
        }

        .member-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .member-drop-area {
            min-height: 50px;
            border: 2px dashed transparent;
            transition: all 0.3s;
        }

        .member-drop-area.highlight {
            border-color: #60a5fa;
            background-color: rgba(96, 165, 250, 0.1);
        }

        .step-indicator {
            position: relative;
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .step {
            position: relative;
            z-index: 1;
        }

        .step-line {
            position: absolute;
            top: 1.25rem;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #e5e7eb;
            z-index: 0;
        }

        .step-line-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: #3b82f6;
            transition: width 0.3s;
        }

        /* === å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ« === */
        @media print {
            @page {
                size: A4 portrait;
                margin: 10mm;
            }

            body {
                background: none;
                background-image: none;
                font-size: 11pt;
                /* A4ã«åã‚ã‚‹ãŸã‚å°‘ã—æ–‡å­—ã‚’å°ã•ã */
            }

            /* å°åˆ·ä¸è¦ãªè¦ç´ ã‚’éè¡¨ç¤º */
            header,
            footer,
            #setup-container,
            #back-to-input,
            #print-groups,
            #toggle-skill-btn,
            .mb-2 {
                display: none !important;
            }

            #results {
                display: block !important;
                width: 100% !important;
            }

            /* ä½™ç™½ã‚’è©°ã‚ã‚‹ */
            .mt-8 {
                margin-top: 0 !important;
            }

            .mb-4 {
                margin-bottom: 10px !important;
            }

            h2 {
                font-size: 16pt !important;
                margin-bottom: 10px !important;
            }

            /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¼·åˆ¶ã—ã€é«˜ã•ã‚’æƒãˆã‚‹ */
            #groups-container {
                display: grid !important;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
                gap: 15px !important;
                align-items: stretch !important;
                /* è¡Œã®è¦ç´ ã®é«˜ã•ã‚’çµ±ä¸€ */
            }

            /* ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
            .group-card {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 0 !important;
                border: 2px solid #3b82f6 !important;
                border-top-width: 2px !important;
                /* Tailwindã®border-t-4ã‚’ä¸Šæ›¸ã */
                box-shadow: none !important;
                display: flex !important;
                flex-direction: column !important;
                height: 100% !important;
                /* é«˜ã•ã‚’æƒãˆã‚‹ãŸã‚ã®ã‚­ãƒ¼ */
                padding: 10px !important;
            }

            /* ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆéƒ¨åˆ†ã‚’ä¼¸ã°ã™ */
            .member-drop-area {
                flex-grow: 1 !important;
                display: flex;
                flex-direction: column;
            }

            /* ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            .member-item {
                border: 1px solid #e5e7eb !important;
                padding: 4px 8px !important;
                margin-bottom: 4px !important;
                background-color: white !important;
            }

            /* å°åˆ·æ™‚ã¯ãƒ‰ãƒ©ãƒƒã‚°ç”¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹ */
            .drag-icon {
                display: none !important;
            }

            /* ã‚¹ã‚­ãƒ«ãƒãƒƒã‚¸ã®æ ç·šã‚’ã¯ã£ãã‚Šã•ã›ã‚‹ */
            .skill-label {
                border: 1px solid currentColor !important;
            }

            /* å°åˆ·æ™‚ã®ã‚°ãƒ«ãƒ¼ãƒ—åå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
            .group-name-input {
                border: none !important;
                background: transparent !important;
                box-shadow: none !important;
                padding: 0 !important;
            }
        }
    </style>
</head>

<body>
    <div class="min-h-screen">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="bg-blue-500 text-white p-4 shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl md:text-3xl font-bold flex items-center">
                    <span class="sports-icon mr-2">âš½</span>
                    ã‚¹ãƒãƒ¼ãƒ„ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã‚¢ãƒ—ãƒª
                    <span class="sports-icon ml-2">ğŸ€</span>
                </h1>
            </div>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="container mx-auto p-4 md:p-8">
            <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div id="setup-container" class="mb-8">
                <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
                <div class="step-indicator mb-8">
                    <div class="step-line">
                        <div id="step-progress" class="step-line-progress" style="width: 0%"></div>
                    </div>
                    <div class="step">
                        <div id="step1-indicator"
                            class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center mx-auto mb-2">
                            1</div>
                        <div class="text-center text-sm">åå‰å…¥åŠ›</div>
                    </div>
                    <div class="step">
                        <div id="step2-indicator"
                            class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mx-auto mb-2">
                            2</div>
                        <div class="text-center text-sm">ã‚¹ã‚­ãƒ«è¨­å®š</div>
                    </div>
                    <div class="step">
                        <div id="step3-indicator"
                            class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mx-auto mb-2">
                            3</div>
                        <div class="text-center text-sm">ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘</div>
                    </div>
                </div>

                <!-- ã‚¹ãƒ†ãƒƒãƒ—1: åå‰å…¥åŠ› -->
                <div id="step1" class="bg-white rounded-xl p-6 shadow-lg mb-8">
                    <h2 class="text-xl font-bold mb-4 text-blue-700 border-b-2 border-blue-300 pb-2">ã‚¹ãƒ†ãƒƒãƒ—1: åå‰å…¥åŠ›</h2>

                    <div class="mb-4">
                        <label for="bulk-data" class="block text-sm font-medium text-gray-700 mb-1">ãƒ¡ãƒ³ãƒãƒ¼ã®åå‰</label>
                        <textarea id="bulk-data" rows="6"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="1è¡Œã«1äººãšã¤åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„&#10;ä¾‹:&#10;å±±ç”°å¤ªéƒ&#10;ä½è—¤èŠ±å­&#10;éˆ´æœ¨ä¸€éƒ"></textarea>
                    </div>

                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                        <p class="text-sm text-gray-500 mb-2 md:mb-0">
                            Excelç­‰ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚<br>
                            å½¢å¼: 1è¡Œã«1äººã®åå‰<br>
                            <span class="text-xs text-blue-500">â€»ä½•ã‚‚å…¥åŠ›ã›ãšã«ã€Œæ¬¡ã¸ã€ã‚’æŠ¼ã™ã¨ã€ç•ªå·ã®ã¿ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒ30äººåˆ†è‡ªå‹•ã§ç”¨æ„ã•ã‚Œã¾ã™ã€‚</span>
                        </p>
                    </div>

                    <div class="mt-6 text-right">
                        <button id="next-to-step2"
                            class="btn-sports bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md shadow-md flex items-center ml-auto">
                            æ¬¡ã¸
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¹ã‚­ãƒ«è¨­å®š -->
                <div id="step2" class="bg-white rounded-xl p-6 shadow-lg mb-8 hidden">
                    <h2 class="text-xl font-bold mb-4 text-blue-700 border-b-2 border-blue-300 pb-2">ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¹ã‚­ãƒ«è¨­å®š</h2>

                    <div class="mb-4">
                        <div class="flex flex-wrap gap-2 mb-4">
                            <div class="flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm">
                                <span class="w-3 h-3 inline-block bg-blue-500 rounded-full mr-1"></span>
                                å¾—æ„
                            </div>
                            <div class="flex items-center px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm">
                                <span class="w-3 h-3 inline-block bg-green-500 rounded-full mr-1"></span>
                                å°‘ã—å¾—æ„
                            </div>
                            <div class="flex items-center px-3 py-1 rounded-full bg-gray-100 text-gray-800 text-sm">
                                <span class="w-3 h-3 inline-block bg-gray-400 rounded-full mr-1"></span>
                                æ™®é€š
                            </div>
                            <div class="flex items-center px-3 py-1 rounded-full bg-yellow-100 text-yellow-800 text-sm">
                                <span class="w-3 h-3 inline-block bg-yellow-500 rounded-full mr-1"></span>
                                å°‘ã—è‹¦æ‰‹
                            </div>
                            <div class="flex items-center px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm">
                                <span class="w-3 h-3 inline-block bg-red-500 rounded-full mr-1"></span>
                                è‹¦æ‰‹
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg max-h-80 overflow-y-auto">
                            <ul id="member-list" class="divide-y divide-gray-200">
                                <!-- ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                                <li class="py-2 text-gray-500 italic">ã¾ã ãƒ¡ãƒ³ãƒãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-between">
                        <button id="back-to-step1"
                            class="btn-sports bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-md shadow-md flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                            æˆ»ã‚‹
                        </button>
                        <button id="next-to-step3"
                            class="btn-sports bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md shadow-md flex items-center">
                            æ¬¡ã¸
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘è¨­å®š -->
                <div id="step3" class="bg-white rounded-xl p-6 shadow-lg mb-8 hidden">
                    <h2 class="text-xl font-bold mb-4 text-blue-700 border-b-2 border-blue-300 pb-2">ã‚¹ãƒ†ãƒƒãƒ—3: ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘è¨­å®š
                    </h2>

                    <div class="flex flex-col md:flex-row items-end space-y-4 md:space-y-0 md:space-x-4">
                        <div class="w-full md:w-1/3">
                            <label for="group-count" class="block text-sm font-medium text-gray-700 mb-1">ã‚°ãƒ«ãƒ¼ãƒ—æ•°</label>
                            <input type="number" id="group-count" min="2" value="2"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <button id="create-groups"
                            class="btn-sports bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md shadow-md flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path
                                    d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                            </svg>
                            ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
                        </button>
                    </div>

                    <div class="mt-6 flex justify-between">
                        <button id="back-to-step2"
                            class="btn-sports bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-md shadow-md flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                            æˆ»ã‚‹
                        </button>
                    </div>
                </div>
            </div>

            <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="results" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-blue-700 flex items-center">
                        <span class="sports-icon mr-2">ğŸ†</span>
                        ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘çµæœ
                        <span class="sports-icon ml-2">ğŸ†</span>
                    </h2>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã§å…¥ã‚Œæ›¿ãˆã‚‰ã‚Œã¾ã™</p>
                    </div>
                </div>

                <div id="groups-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- ã‚°ãƒ«ãƒ¼ãƒ—ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>

                <div class="mt-8 text-center flex flex-wrap justify-center gap-4">
                    <button id="back-to-input"
                        class="btn-sports bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-md shadow-md inline-flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z"
                                clip-rule="evenodd" />
                        </svg>
                        è¨­å®šã«æˆ»ã‚‹
                    </button>

                    <button id="toggle-skill-btn"
                        class="btn-sports bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-md shadow-md inline-flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                            <path fill-rule="evenodd"
                                d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                                clip-rule="evenodd" />
                        </svg>
                        <span id="toggle-skill-text">ã‚¹ã‚­ãƒ«ã‚’éš ã™</span>
                    </button>

                    <button id="print-groups"
                        class="btn-sports bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-md shadow-md inline-flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z"
                                clip-rule="evenodd" />
                        </svg>
                        å°åˆ·ã™ã‚‹
                    </button>
                </div>
            </div>
        </main>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer class="bg-blue-500 text-white p-4 mt-8">
            <div class="container mx-auto text-center">
                <p>Â© 2026 ã‚¹ãƒãƒ¼ãƒ„ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã‚¢ãƒ—ãƒª</p>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // è¦ç´ ã®å–å¾—
            const memberList = document.getElementById('member-list');
            const groupCountInput = document.getElementById('group-count');
            const createGroupsBtn = document.getElementById('create-groups');
            const results = document.getElementById('results');
            const groupsContainer = document.getElementById('groups-container');
            const backToInputBtn = document.getElementById('back-to-input');
            const bulkDataTextarea = document.getElementById('bulk-data');
            const printGroupsBtn = document.getElementById('print-groups');
            const toggleSkillBtn = document.getElementById('toggle-skill-btn');
            const toggleSkillText = document.getElementById('toggle-skill-text');

            // ã‚¹ãƒ†ãƒƒãƒ—é–¢é€£ã®è¦ç´ 
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const setupContainer = document.getElementById('setup-container');
            const stepProgress = document.getElementById('step-progress');
            const step1Indicator = document.getElementById('step1-indicator');
            const step2Indicator = document.getElementById('step2-indicator');
            const step3Indicator = document.getElementById('step3-indicator');

            // ã‚¹ãƒ†ãƒƒãƒ—é–“ã®ç§»å‹•ãƒœã‚¿ãƒ³
            const nextToStep2Btn = document.getElementById('next-to-step2');
            const nextToStep3Btn = document.getElementById('next-to-step3');
            const backToStep1Btn = document.getElementById('back-to-step1');
            const backToStep2Btn = document.getElementById('back-to-step2');

            // ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆ
            let members = [];
            // å‡ºå¸­ç•ªå·ã®æœ€å¤§å€¤
            let maxStudentNumber = 0;
            // ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘çµæœ
            let groupsResult = [];
            // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—
            let currentStep = 1;
            // ã‚¹ã‚­ãƒ«ã®è¡¨ç¤ºçŠ¶æ…‹
            let isSkillVisible = true;

            // åˆæœŸåŒ–æ™‚ã«ç©ºã®ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿(30äººåˆ†)ã‚’è£ã§ç”Ÿæˆã—ã¦ãŠã
            generateDefaultNumbers();

            // ã‚¹ãƒ†ãƒƒãƒ—ã®è¡¨ç¤ºã‚’æ›´æ–°
            function updateStepDisplay(step) {
                currentStep = step;

                // ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’éè¡¨ç¤º
                step1.classList.add('hidden');
                step2.classList.add('hidden');
                step3.classList.add('hidden');

                // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤º
                document.getElementById('step' + step).classList.remove('hidden');

                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’æ›´æ–° (3ã‚¹ãƒ†ãƒƒãƒ—ãªã®ã§ 0%, 50%, 100%)
                stepProgress.style.width = ((step - 1) * 50) + '%';

                // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
                step1Indicator.className = step >= 1 ? 'w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center mx-auto mb-2' : 'w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mx-auto mb-2';
                step2Indicator.className = step >= 2 ? 'w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center mx-auto mb-2' : 'w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mx-auto mb-2';
                step3Indicator.className = step >= 3 ? 'w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center mx-auto mb-2' : 'w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mx-auto mb-2';
            }

            // ã‚¹ãƒ†ãƒƒãƒ—é–“ã®ç§»å‹•
            nextToStep2Btn.addEventListener('click', function () {
                const bulkData = bulkDataTextarea.value.trim();

                if (bulkData) {
                    // å…¥åŠ›ãŒã‚ã‚‹å ´åˆã€ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰åå‰ã‚’èª­ã¿å–ã£ã¦ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç”Ÿæˆ
                    members = [];
                    const rows = bulkData.split('\n');
                    let number = 1;

                    for (const row of rows) {
                        const name = row.trim();
                        if (!name) continue; // ç©ºè¡Œã¯ã‚¹ã‚­ãƒƒãƒ—

                        members.push({
                            number: number++,
                            name: name,
                            skill: 'neutral'
                        });
                    }
                    maxStudentNumber = members.length;

                    if (members.length === 0) {
                        alert('æœ‰åŠ¹ãªåå‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                        return; // ã‚¨ãƒ©ãƒ¼æ™‚ã¯é€²ã¾ãªã„
                    }
                } else {
                    // å…¥åŠ›ãŒãªã„å ´åˆã€30äººã®ç©ºãƒ¡ãƒ³ãƒãƒ¼ã‚’ç”Ÿæˆ
                    generateDefaultNumbers();
                }

                updateStepDisplay(2);
                updateMemberList();
            });

            nextToStep3Btn.addEventListener('click', function () {
                updateStepDisplay(3);
            });

            backToStep1Btn.addEventListener('click', function () {
                updateStepDisplay(1);
            });

            backToStep2Btn.addEventListener('click', function () {
                updateStepDisplay(2);
            });

            // å‡ºå¸­ç•ªå·è‡ªå‹•ç”Ÿæˆï¼ˆåˆæœŸåŒ–ç”¨ãƒ»30äººï¼‰
            function generateDefaultNumbers() {
                maxStudentNumber = 30;
                members = [];
                for (let i = 1; i <= 30; i++) {
                    members.push({
                        number: i,
                        name: '',
                        skill: 'neutral'
                    });
                }
            }

            // ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã®æ›´æ–°
            function updateMemberList() {
                if (members.length === 0) {
                    memberList.innerHTML = '<li class="py-2 text-gray-500 italic">ã¾ã ãƒ¡ãƒ³ãƒãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</li>';
                    return;
                }

                // å‡ºå¸­ç•ªå·é †ã«ã‚½ãƒ¼ãƒˆ
                members.sort((a, b) => a.number - b.number);

                memberList.innerHTML = '';
                members.forEach((member, index) => {
                    const li = document.createElement('li');
                    li.className = 'py-2 flex justify-between items-center';

                    const displayName = member.name ? `${member.number}. ${member.name}` : `${member.number}`;

                    li.innerHTML = `
                        <div>
                            <span class="font-medium">${displayName}</span>
                        </div>
                        <div class="flex items-center">
                            <div class="mr-4">
                                <select class="skill-select px-2 py-1 border border-gray-300 rounded text-sm" data-index="${index}">
                                    <option value="very-good" ${member.skill === 'very-good' ? 'selected' : ''}>å¾—æ„</option>
                                    <option value="good" ${member.skill === 'good' ? 'selected' : ''}>å°‘ã—å¾—æ„</option>
                                    <option value="neutral" ${member.skill === 'neutral' ? 'selected' : ''}>æ™®é€š</option>
                                    <option value="bad" ${member.skill === 'bad' ? 'selected' : ''}>å°‘ã—è‹¦æ‰‹</option>
                                    <option value="very-bad" ${member.skill === 'very-bad' ? 'selected' : ''}>è‹¦æ‰‹</option>
                                </select>
                            </div>
                        </div>
                    `;
                    memberList.appendChild(li);
                });

                // ã‚¹ã‚­ãƒ«é¸æŠã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
                document.querySelectorAll('.skill-select').forEach(select => {
                    select.addEventListener('change', function () {
                        const index = parseInt(this.getAttribute('data-index'));
                        members[index].skill = this.value;
                    });
                });
            }

            // ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆå‡¦ç†
            createGroupsBtn.addEventListener('click', function () {
                if (members.length === 0) {
                    alert('ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã—ã¦ãã ã•ã„');
                    return;
                }

                const groupCount = parseInt(groupCountInput.value);
                if (isNaN(groupCount) || groupCount < 2) {
                    alert('ã‚°ãƒ«ãƒ¼ãƒ—æ•°ã¯2ä»¥ä¸Šã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                if (members.length < groupCount) {
                    alert('ãƒ¡ãƒ³ãƒãƒ¼æ•°ãŒã‚°ãƒ«ãƒ¼ãƒ—æ•°ã‚ˆã‚Šå°‘ãªã„ã§ã™');
                    return;
                }

                // ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘å®Ÿè¡Œ
                groupsResult = createBalancedGroups(members, groupCount);

                // çµæœè¡¨ç¤º
                showResults(groupsResult);
            });

            // ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ (5æ®µéšå¯¾å¿œ)
            function createBalancedGroups(membersList, count) {
                // ãƒ¡ãƒ³ãƒãƒ¼ã‚’ã‚¹ã‚­ãƒ«ã§ã‚½ãƒ¼ãƒˆ
                const veryGoodMembers = membersList.filter(m => m.skill === 'very-good');
                const goodMembers = membersList.filter(m => m.skill === 'good');
                const neutralMembers = membersList.filter(m => m.skill === 'neutral');
                const badMembers = membersList.filter(m => m.skill === 'bad');
                const veryBadMembers = membersList.filter(m => m.skill === 'very-bad');

                // å„ã‚°ãƒ«ãƒ¼ãƒ—å†…ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
                shuffleArray(veryGoodMembers);
                shuffleArray(goodMembers);
                shuffleArray(neutralMembers);
                shuffleArray(badMembers);
                shuffleArray(veryBadMembers);

                // ã‚°ãƒ«ãƒ¼ãƒ—åˆæœŸåŒ–
                const groups = Array.from({ length: count }, () => []);

                // ä¸¡æ¥µç«¯ã‹ã‚‰é †ã«å‡ç­‰ã«åˆ†é…ã—ã€ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹
                distributeMembers(veryGoodMembers, groups);
                distributeMembers(veryBadMembers, groups);
                distributeMembers(goodMembers, groups);
                distributeMembers(badMembers, groups);
                distributeMembers(neutralMembers, groups);

                return groups;
            }

            // ãƒ¡ãƒ³ãƒãƒ¼ã‚’å‡ç­‰ã«åˆ†é…
            function distributeMembers(membersList, groups) {
                for (let i = 0; i < membersList.length; i++) {
                    // æœ€ã‚‚äººæ•°ãŒå°‘ãªã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¦‹ã¤ã‘ã‚‹
                    let minGroupIndex = 0;
                    for (let j = 1; j < groups.length; j++) {
                        if (groups[j].length < groups[minGroupIndex].length) {
                            minGroupIndex = j;
                        }
                    }
                    groups[minGroupIndex].push(membersList[i]);
                }
            }

            // é…åˆ—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // ã‚¹ã‚­ãƒ«è¡¨ç¤ºã®ãƒˆã‚°ãƒ«åˆ‡ã‚Šæ›¿ãˆ
            toggleSkillBtn.addEventListener('click', function () {
                isSkillVisible = !isSkillVisible;

                const skillLabels = document.querySelectorAll('.skill-label');
                skillLabels.forEach(label => {
                    label.style.display = isSkillVisible ? 'inline-block' : 'none';
                });

                toggleSkillText.textContent = isSkillVisible ? 'ã‚¹ã‚­ãƒ«ã‚’éš ã™' : 'ã‚¹ã‚­ãƒ«ã‚’è¡¨ç¤º';
            });

            // çµæœè¡¨ç¤º
            function showResults(groups) {
                // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤º
                setupContainer.classList.add('hidden');

                // çµæœã‚’è¡¨ç¤º
                results.classList.remove('hidden');

                // ã‚°ãƒ«ãƒ¼ãƒ—ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªã‚¢
                groupsContainer.innerHTML = '';

                // ã‚¹ãƒãƒ¼ãƒ„ã‚¢ã‚¤ã‚³ãƒ³
                const sportsIcons = ['âš½', 'ğŸ€', 'ğŸ', 'ğŸ¾', 'ğŸˆ', 'âš¾', 'ğŸ‰', 'ğŸ“', 'ğŸ¸', 'ğŸŠâ™‚ï¸', 'ğŸ„â™€ï¸', 'ğŸš´â™‚ï¸'];

                // å„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¡¨ç¤º
                groups.forEach((group, index) => {
                    const iconIndex = index % sportsIcons.length;
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'group-card bg-white rounded-xl p-4 shadow-lg border-t-4 border-blue-500 flex flex-col h-full';
                    groupDiv.dataset.groupIndex = index;

                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'flex items-center justify-between mb-3 pb-2 border-b border-gray-200 flex-shrink-0';

                    groupHeader.innerHTML = `
                        <input type="text" value="ã‚°ãƒ«ãƒ¼ãƒ— ${index + 1}" class="group-name-input text-lg font-bold text-blue-700 bg-transparent border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none px-1 py-1 w-full mr-2 transition-colors" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›">
                        <span class="text-2xl flex-shrink-0">${sportsIcons[iconIndex]}</span>
                    `;

                    const membersList = document.createElement('ul');
                    membersList.className = 'member-drop-area space-y-2 flex-grow';
                    membersList.dataset.groupIndex = index;

                    // å‡ºå¸­ç•ªå·é †ã«ã‚½ãƒ¼ãƒˆ
                    group.sort((a, b) => a.number - b.number);

                    group.forEach(member => {
                        const li = createMemberItem(member, index);
                        membersList.appendChild(li);
                    });

                    groupDiv.appendChild(groupHeader);
                    groupDiv.appendChild(membersList);
                    groupsContainer.appendChild(groupDiv);
                });

                // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã®è¨­å®š
                setupDragAndDrop();

                // ãƒšãƒ¼ã‚¸ã®ä¸Šéƒ¨ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ä½œæˆ
            function createMemberItem(member, groupIndex) {
                const li = document.createElement('li');
                li.className = 'member-item p-2 rounded-md border border-gray-200 bg-white';
                li.draggable = true;
                li.dataset.memberNumber = member.number;
                li.dataset.groupIndex = groupIndex;

                const displayName = member.name ?
                    `${member.number}. ${member.name}` :
                    `${member.number}`;

                let skillText = '';
                let skillBgColor = '';
                let skillTextColor = '';

                switch (member.skill) {
                    case 'very-good':
                        skillText = 'å¾—æ„';
                        skillBgColor = 'bg-blue-100';
                        skillTextColor = 'text-blue-800';
                        break;
                    case 'good':
                        skillText = 'å°‘ã—å¾—æ„';
                        skillBgColor = 'bg-green-100';
                        skillTextColor = 'text-green-800';
                        break;
                    case 'neutral':
                        skillText = 'æ™®é€š';
                        skillBgColor = 'bg-gray-100';
                        skillTextColor = 'text-gray-800';
                        break;
                    case 'bad':
                        skillText = 'å°‘ã—è‹¦æ‰‹';
                        skillBgColor = 'bg-yellow-100';
                        skillTextColor = 'text-yellow-800';
                        break;
                    case 'very-bad':
                        skillText = 'è‹¦æ‰‹';
                        skillBgColor = 'bg-red-100';
                        skillTextColor = 'text-red-800';
                        break;
                }

                const displayStyle = isSkillVisible ? 'inline-block' : 'none';

                li.innerHTML = `
                    <div class="flex items-center w-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-blue-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                        <span class="flex-grow truncate mr-2">${displayName}</span>
                        <span class="skill-label text-xs font-semibold px-2 py-0.5 rounded-full ${skillBgColor} ${skillTextColor} flex-shrink-0" style="display: ${displayStyle};">${skillText}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="drag-icon h-4 w-4 ml-2 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </div>
                `;

                return li;
            }

            // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã®è¨­å®š
            function setupDragAndDrop() {
                const memberItems = document.querySelectorAll('.member-item');
                const dropAreas = document.querySelectorAll('.member-drop-area');

                let draggedItem = null;

                memberItems.forEach(item => {
                    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
                    item.addEventListener('dragstart', function (e) {
                        draggedItem = this;
                        setTimeout(() => {
                            this.classList.add('dragging');
                        }, 0);
                    });

                    // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†
                    item.addEventListener('dragend', function () {
                        this.classList.remove('dragging');
                    });
                });

                dropAreas.forEach(area => {
                    // ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼
                    area.addEventListener('dragover', function (e) {
                        e.preventDefault();
                        this.classList.add('highlight');
                    });

                    // ãƒ‰ãƒ©ãƒƒã‚°ãƒªãƒ¼ãƒ–
                    area.addEventListener('dragleave', function () {
                        this.classList.remove('highlight');
                    });

                    // ãƒ‰ãƒ­ãƒƒãƒ—
                    area.addEventListener('drop', function (e) {
                        e.preventDefault();
                        this.classList.remove('highlight');

                        if (draggedItem) {
                            // å…ƒã®ã‚°ãƒ«ãƒ¼ãƒ—ã¨æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
                            const fromGroupIndex = parseInt(draggedItem.dataset.groupIndex);
                            const toGroupIndex = parseInt(this.dataset.groupIndex);

                            // ãƒ¡ãƒ³ãƒãƒ¼ç•ªå·
                            const memberNumber = parseInt(draggedItem.dataset.memberNumber);

                            // ã‚°ãƒ«ãƒ¼ãƒ—é–“ã§ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç§»å‹•
                            if (fromGroupIndex !== toGroupIndex) {
                                // ãƒ¡ãƒ³ãƒãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã¤ã‘ã‚‹
                                const memberIndex = groupsResult[fromGroupIndex].findIndex(m => m.number === memberNumber);
                                if (memberIndex !== -1) {
                                    // ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç§»å‹•
                                    const member = groupsResult[fromGroupIndex].splice(memberIndex, 1)[0];
                                    groupsResult[toGroupIndex].push(member);

                                    // UIã‚’æ›´æ–°
                                    this.appendChild(draggedItem);
                                    draggedItem.dataset.groupIndex = toGroupIndex;
                                }
                            }
                        }
                    });
                });
            }

            // å°åˆ·æ©Ÿèƒ½
            printGroupsBtn.addEventListener('click', function () {
                window.print();
            });

            // å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«æˆ»ã‚‹
            backToInputBtn.addEventListener('click', function () {
                results.classList.add('hidden');
                setupContainer.classList.remove('hidden');
                updateStepDisplay(1);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>

</html>