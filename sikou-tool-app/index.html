<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>思考ツール</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Konva.js (CDN) -->
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
        }

        /* Custom UI */
        #text-editor {
            position: absolute;
            display: none;
            z-index: 100;
            border: 2px solid #3b82f6;
            border-radius: 4px;
            padding: 4px;
            font-family: 'Noto Sans JP', sans-serif;
            outline: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            resize: none;
            overflow: hidden;
            background: transparent;
            line-height: 1.2;
        }

        #popover {
            position: absolute;
            display: none;
            background: white;
            padding: 8px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 90;
            display: flex;
            gap: 8px;
            border: 1px solid #e2e8f0;
        }

        .color-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .color-btn:hover {
            transform: scale(1.1);
        }

        .color-btn.active {
            border-color: #1e293b;
            transform: scale(1.1);
        }

        .overlay-btn {
            position: absolute;
            display: none;
            width: 36px;
            height: 36px;
            color: white;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            cursor: pointer;
            z-index: 50;
            transition: background-color 0.2s, transform 0.2s;
            border: none;
            transform: translate(-50%, -50%);
        }

        #btn-delete-item {
            background-color: #ef4444;
            font-size: 20px;
        }

        #btn-delete-item:hover {
            background-color: #dc2626;
            transform: translate(-50%, -50%) scale(1.1);
        }

        #btn-connect-item {
            background-color: #3b82f6;
            font-size: 16px;
        }

        #btn-connect-item:hover {
            background-color: #2563eb;
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Scrollbar styles for template menu */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="flex h-screen w-full">

    <!-- Sidebar -->
    <div class="w-64 bg-white border-r border-slate-200 h-full flex flex-col p-4 shadow-sm z-10 relative shrink-0">
        <div class="mb-8">
            <h1 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="w-6 h-6 text-blue-500">
                    <path
                        d="m12 3-1.9 5.8a2 2 0 0 1-1.287 1.288L3 12l5.8 1.9a2 2 0 0 1 1.288 1.287L12 21l1.9-5.8a2 2 0 0 1 1.287-1.288L21 12l-5.8-1.9a2 2 0 0 1-1.288-1.287Z" />
                    <path d="m16 9 2 2-2 2" />
                    <path d="m8 15-2-2 2-2" />
                </svg>
                思考ツール
            </h1>
            <p class="text-sm text-slate-500 mt-1">考えを整理しよう</p>
        </div>

        <div class="flex flex-col gap-4 flex-1 overflow-y-auto custom-scrollbar pr-2 -mr-2">
            <div class="space-y-2">
                <h2 class="text-sm font-semibold text-slate-700 uppercase tracking-wider">操作モード</h2>
                <div class="flex flex-col gap-2 mb-4">
                    <button id="btn-mode-pointer"
                        class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium bg-slate-800 text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z" />
                            <path d="m13 13 6 6" />
                        </svg>
                        選択・移動
                    </button>
                    <button id="btn-mode-lasso"
                        class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium border border-slate-200 text-slate-600 hover:bg-slate-50 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 3a2 2 0 0 0-2 2" />
                            <path d="M19 3a2 2 0 0 1 2 2" />
                            <path d="M21 19a2 2 0 0 1-2 2" />
                            <path d="M5 21a2 2 0 0 1-2-2" />
                            <path d="M9 3h1" />
                            <path d="M9 21h1" />
                            <path d="M14 3h1" />
                            <path d="M14 21h1" />
                            <path d="M3 9v1" />
                            <path d="M21 9v1" />
                            <path d="M3 14v1" />
                            <path d="M21 14v1" />
                        </svg>
                        囲んで選択
                    </button>
                </div>

                <h2 class="text-sm font-semibold text-slate-700 uppercase tracking-wider mt-6 mb-2">追加ツール</h2>
                <button id="btn-add-sticky"
                    class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M8 12h8" />
                        <path d="M12 8v8" />
                    </svg>
                    ふせんを追加
                </button>

                <button id="btn-add-text"
                    class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium bg-purple-50 hover:bg-purple-100 text-purple-700 border border-purple-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="4 7 4 4 20 4 20 7" />
                        <line x1="9" x2="15" y1="20" y2="20" />
                        <line x1="12" x2="12" y1="4" y2="20" />
                    </svg>
                    テキストを追加
                </button>

                <label
                    class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium bg-orange-50 hover:bg-orange-100 text-orange-700 border border-orange-200 transition-colors cursor-pointer">
                    <input type="file" id="image-upload" accept="image/*" class="hidden" />
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
                        <circle cx="9" cy="9" r="2" />
                        <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
                    </svg>
                    画像を追加
                </label>

                <div class="relative mt-2">
                    <button id="btn-templates-toggle"
                        class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium bg-emerald-50 hover:bg-emerald-100 text-emerald-700 border border-emerald-200 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="7" x="3" y="3" rx="1" />
                            <rect width="9" height="7" x="3" y="14" rx="1" />
                            <rect width="5" height="7" x="16" y="14" rx="1" />
                        </svg>
                        テンプレート
                    </button>
                    <!-- Template Dropdown -->
                    <div id="templates-menu"
                        class="hidden absolute left-0 top-full mt-1 w-full bg-white border border-slate-200 rounded-md shadow-lg z-50 py-1 origin-top-left transform transition-all">
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="x">Xチャート (分類)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="y">Yチャート (分類)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="axis">座標軸 (順序付け)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="venn">ベン図 (比較)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="pmi">PMIチャート (分析)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="kwl">KWLチャート (振り返り)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="jellyfish">クラゲチャート (見通す)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="fishbone">フィッシュボーン図 (構造化)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="candy">キャンディーチャート(因果関係)</button>
                        <button class="tpl-option w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
                            data-type="pyramid">ピラミッドチャート (焦点化)</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-auto space-y-2 pt-4 border-t border-slate-100">
            <button id="btn-export"
                class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium border border-slate-200 text-slate-700 hover:bg-slate-50 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" x2="12" y1="15" y2="3" />
                </svg>
                画像として保存
            </button>
            <button id="btn-clear"
                class="flex items-center gap-2 w-full px-4 py-2 rounded-md text-sm font-medium text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 6h18" />
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                    <line x1="10" x2="10" y1="11" y2="17" />
                    <line x1="14" x2="14" y1="11" y2="17" />
                </svg>
                すべて消去
            </button>
        </div>
    </div>

    <!-- Canvas Area with Overlays -->
    <div id="canvas-container" class="flex-1 h-full w-full relative bg-slate-50 cursor-default">
        <!-- DOM Overlays -->
        <textarea id="text-editor" placeholder="入力を始めましょう"></textarea>

        <div id="popover" style="display: none;">
            <button class="color-btn" style="background-color: #fef08a; border-color: #1e293b;"
                data-color="#fef08a"></button>
            <button class="color-btn" style="background-color: #bfdbfe;" data-color="#bfdbfe"></button>
            <button class="color-btn" style="background-color: #bbf7d0;" data-color="#bbf7d0"></button>
            <button class="color-btn" style="background-color: #fbcfe8;" data-color="#fbcfe8"></button>
            <button class="color-btn" style="background-color: #e9d5ff;" data-color="#e9d5ff"></button>
        </div>

        <button id="btn-delete-item" class="overlay-btn" title="削除">&times;</button>
        <button id="btn-connect-item" class="overlay-btn" title="繋ぐ"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
            </svg></button>
    </div>

    <script src="main.js"></script>
</body>

</html>